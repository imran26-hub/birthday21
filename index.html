<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0"/>
<title>For You â™¡</title>
<link href="https://fonts.googleapis.com/css2?family=Playfair+Display:ital,wght@0,400;0,700;1,400;1,700&family=Cormorant+Garamond:ital,wght@0,300;0,400;1,300;1,400&family=Lato:wght@300;400&display=swap" rel="stylesheet"/>
<script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
<style>
  :root {
    --rose: #c9506a;
    --blush: #f2d7de;
    --petal: #f9eef1;
    --cream: #fdf6f0;
    --gold: #c9a96e;
    --dark: #2c1a1f;
    --muted: #9a7b82;
  }

  * { margin: 0; padding: 0; box-sizing: border-box; }

  body {
    font-family: 'Lato', sans-serif;
    background: var(--cream);
    color: var(--dark);
    min-height: 100vh;
    overflow-x: hidden;
  }

  #petals-canvas {
    position: fixed; top: 0; left: 0;
    width: 100%; height: 100%;
    pointer-events: none; z-index: 0; opacity: 0.35;
  }

  /* â”€â”€â”€ LOGIN â”€â”€â”€ */
  #login-screen {
    position: fixed; inset: 0; z-index: 100;
    display: flex; align-items: center; justify-content: center;
    background: linear-gradient(145deg, #fdf0f3 0%, #f9e8ee 40%, #f2d7de 100%);
  }

  .login-box {
    background: rgba(255,255,255,0.82);
    backdrop-filter: blur(16px);
    border: 1px solid rgba(201,80,106,0.18);
    border-radius: 24px;
    padding: 52px 44px 44px;
    width: 380px; max-width: 95vw;
    text-align: center;
    box-shadow: 0 32px 80px rgba(201,80,106,0.12), 0 4px 24px rgba(0,0,0,0.06);
    animation: floatIn 0.9s cubic-bezier(0.22,1,0.36,1) both;
  }
  @keyframes floatIn {
    from { opacity: 0; transform: translateY(40px) scale(0.96); }
    to   { opacity: 1; transform: translateY(0) scale(1); }
  }

  .login-heart {
    font-size: 3rem; display: block; margin-bottom: 12px;
    animation: heartbeat 2.2s ease-in-out infinite;
  }
  @keyframes heartbeat {
    0%,100% { transform: scale(1); }
    14% { transform: scale(1.18); }
    28% { transform: scale(1); }
    42% { transform: scale(1.12); }
    56% { transform: scale(1); }
  }

  .login-title {
    font-family: 'Playfair Display', serif;
    font-size: 2rem; color: var(--rose); margin-bottom: 4px; font-style: italic;
  }
  .login-subtitle {
    font-family: 'Cormorant Garamond', serif;
    font-size: 1rem; color: var(--muted); margin-bottom: 32px;
    font-style: italic; letter-spacing: 0.05em;
  }

  .tab-group {
    display: flex; border-radius: 12px; background: var(--petal);
    padding: 4px; margin-bottom: 24px; gap: 4px;
  }
  .tab-btn {
    flex: 1; padding: 9px; border: none; border-radius: 9px;
    background: transparent; cursor: pointer;
    font-family: 'Lato', sans-serif; font-size: 0.82rem;
    letter-spacing: 0.06em; text-transform: uppercase; color: var(--muted);
    transition: all 0.25s;
  }
  .tab-btn.active {
    background: #fff; color: var(--rose);
    box-shadow: 0 2px 8px rgba(201,80,106,0.12);
  }

  .login-field { margin-bottom: 16px; text-align: left; }
  .login-field label {
    display: block; font-size: 0.72rem; letter-spacing: 0.1em;
    text-transform: uppercase; color: var(--muted); margin-bottom: 7px;
  }
  .login-field input {
    width: 100%; padding: 13px 16px;
    border: 1.5px solid rgba(201,80,106,0.2); border-radius: 10px;
    background: rgba(255,255,255,0.9);
    font-family: 'Lato', sans-serif; font-size: 0.95rem; color: var(--dark);
    outline: none; transition: border-color 0.2s, box-shadow 0.2s;
  }
  .login-field input:focus {
    border-color: var(--rose); box-shadow: 0 0 0 3px rgba(201,80,106,0.1);
  }

  .login-btn {
    width: 100%; padding: 14px;
    background: linear-gradient(135deg, var(--rose) 0%, #e07090 100%);
    color: #fff; border: none; border-radius: 12px;
    font-family: 'Lato', sans-serif; font-size: 0.9rem;
    letter-spacing: 0.12em; text-transform: uppercase;
    cursor: pointer; margin-top: 8px; transition: all 0.25s;
    box-shadow: 0 6px 20px rgba(201,80,106,0.3);
  }
  .login-btn:hover { transform: translateY(-2px); box-shadow: 0 10px 28px rgba(201,80,106,0.38); }
  .login-error { color: var(--rose); font-size: 0.82rem; margin-top: 12px; min-height: 18px; font-style: italic; }

  .forgot-link {
    display: block; margin-top: 14px;
    font-family: 'Cormorant Garamond', serif; font-size: 0.9rem;
    color: var(--muted); font-style: italic; text-decoration: none;
    transition: color 0.2s; cursor: pointer;
  }
  .forgot-link:hover { color: var(--rose); text-decoration: underline; }

  /* â”€â”€â”€ RESET PASSWORD MODAL â”€â”€â”€ */
  #reset-modal {
    position: fixed; inset: 0; z-index: 200;
    background: rgba(28,10,14,0.75); backdrop-filter: blur(8px);
    display: none; align-items: center; justify-content: center; padding: 24px;
  }
  #reset-modal.open { display: flex; animation: fadeIn 0.3s ease; }
  @keyframes fadeIn { from{opacity:0;} to{opacity:1;} }

  .reset-box {
    background: rgba(255,255,255,0.95);
    border: 1px solid rgba(201,80,106,0.2);
    border-radius: 24px;
    padding: 40px 36px;
    width: 420px; max-width: 95vw;
    text-align: center;
    box-shadow: 0 32px 80px rgba(201,80,106,0.2);
    animation: popUp 0.4s cubic-bezier(0.34,1.56,0.64,1);
    position: relative;
  }
  @keyframes popUp {
    from { opacity: 0; transform: scale(0.8); }
    to   { opacity: 1; transform: scale(1); }
  }

  .reset-close {
    position: absolute; top: 16px; right: 16px;
    background: none; border: none; font-size: 1.5rem;
    color: var(--muted); cursor: pointer;
    transition: color 0.2s, transform 0.2s;
    line-height: 1;
  }
  .reset-close:hover { color: var(--rose); transform: rotate(90deg); }

  .reset-icon { font-size: 2.5rem; margin-bottom: 14px; display: block; }

  .reset-title {
    font-family: 'Playfair Display', serif;
    font-size: 1.6rem; color: var(--rose);
    margin-bottom: 8px; font-style: italic;
  }
  .reset-subtitle {
    font-family: 'Cormorant Garamond', serif;
    font-size: 0.95rem; color: var(--muted);
    margin-bottom: 28px; font-style: italic;
  }

  .reset-field { margin-bottom: 18px; text-align: left; }
  .reset-field label {
    display: block; font-size: 0.72rem;
    letter-spacing: 0.1em; text-transform: uppercase;
    color: var(--muted); margin-bottom: 7px;
  }
  .reset-field input {
    width: 100%; padding: 12px 16px;
    border: 1.5px solid rgba(201,80,106,0.2);
    border-radius: 10px; background: var(--cream);
    font-family: 'Lato', sans-serif; font-size: 0.9rem;
    color: var(--dark); outline: none;
    transition: border-color 0.2s, box-shadow 0.2s;
  }
  .reset-field input:focus {
    border-color: var(--rose);
    box-shadow: 0 0 0 3px rgba(201,80,106,0.1);
  }

  .reset-code-input {
    text-align: center; font-size: 1.5rem !important;
    letter-spacing: 0.5em; font-weight: 600;
  }

  .reset-btn {
    width: 100%; padding: 13px;
    background: linear-gradient(135deg, var(--rose), #e07090);
    color: #fff; border: none; border-radius: 12px;
    font-family: 'Lato', sans-serif; font-size: 0.85rem;
    letter-spacing: 0.1em; text-transform: uppercase;
    cursor: pointer; transition: all 0.25s;
    box-shadow: 0 4px 16px rgba(201,80,106,0.25);
  }
  .reset-btn:hover { transform: translateY(-2px); box-shadow: 0 8px 24px rgba(201,80,106,0.35); }
  .reset-btn:disabled {
    opacity: 0.6; cursor: not-allowed; transform: none;
  }

  .reset-message {
    margin-top: 14px; font-size: 0.82rem; min-height: 18px;
    font-family: 'Cormorant Garamond', serif; font-style: italic;
  }
  .reset-message.error { color: var(--rose); }
  .reset-message.success { color: #5a9e6f; }

  .reset-steps { display: flex; gap: 12px; margin-bottom: 24px; justify-content: center; }
  .reset-step {
    width: 32px; height: 32px; border-radius: 50%;
    background: var(--petal); color: var(--muted);
    display: flex; align-items: center; justify-content: center;
    font-size: 0.85rem; font-weight: 600;
    transition: all 0.3s;
  }
  .reset-step.active {
    background: var(--rose); color: #fff;
    box-shadow: 0 4px 12px rgba(201,80,106,0.3);
  }
  .reset-step.done {
    background: #5a9e6f; color: #fff;
  }

  .spinner {
    display: inline-block;
    width: 18px; height: 18px;
    border: 2px solid rgba(201,80,106,0.2);
    border-top-color: var(--rose);
    border-radius: 50%;
    animation: spin 0.8s linear infinite;
  }
  @keyframes spin { to { transform: rotate(360deg); } }

  /* â”€â”€â”€ (rest of the styles same as before) â”€â”€â”€ */
  #main-site { display: none; position: relative; z-index: 1; }

  header {
    position: sticky; top: 0; z-index: 50;
    background: rgba(253,246,240,0.88); backdrop-filter: blur(18px);
    border-bottom: 1px solid rgba(201,80,106,0.1);
    padding: 0 40px; height: 68px;
    display: flex; align-items: center; justify-content: space-between;
  }
  .header-brand {
    font-family: 'Playfair Display', serif;
    font-size: 1.5rem; color: var(--rose); font-style: italic;
  }
  .header-right { display: flex; align-items: center; gap: 20px; }
  .role-badge {
    font-size: 0.72rem; letter-spacing: 0.1em; text-transform: uppercase;
    color: var(--muted); padding: 5px 12px;
    border: 1px solid rgba(201,80,106,0.25); border-radius: 100px;
  }
  .logout-btn {
    background: none; border: none; cursor: pointer; color: var(--muted);
    font-size: 0.8rem; letter-spacing: 0.06em; transition: color 0.2s;
    font-family: 'Lato', sans-serif;
  }
  .logout-btn:hover { color: var(--rose); }

  .hero { text-align: center; padding: 80px 24px 56px; position: relative; }
  .hero-eyebrow {
    font-family: 'Cormorant Garamond', serif; font-size: 1rem;
    color: var(--gold); letter-spacing: 0.22em; text-transform: uppercase;
    margin-bottom: 18px; display: block;
  }
  .hero-title {
    font-family: 'Playfair Display', serif;
    font-size: clamp(2.8rem, 7vw, 5.5rem); line-height: 1.12;
    color: var(--dark); margin-bottom: 20px;
  }
  .hero-title em { color: var(--rose); font-style: italic; }
  .hero-subtitle {
    font-family: 'Cormorant Garamond', serif; font-size: 1.25rem;
    color: var(--muted); max-width: 520px; margin: 0 auto 40px;
    line-height: 1.7; font-style: italic;
  }
  .hero-divider {
    display: flex; align-items: center; justify-content: center;
    gap: 14px; color: var(--rose); font-size: 1.1rem; opacity: 0.5;
  }
  .hero-divider::before, .hero-divider::after {
    content: ''; height: 1px; width: 60px;
    background: var(--rose); opacity: 0.3;
  }

  #admin-panel { max-width: 760px; margin: 0 auto 60px; padding: 0 24px; display: none; }

  .upload-zone {
    border: 2px dashed rgba(201,80,106,0.3); border-radius: 20px;
    padding: 52px 32px; text-align: center;
    background: rgba(242,215,222,0.15);
    cursor: pointer; transition: all 0.25s; position: relative;
  }
  .upload-zone:hover, .upload-zone.dragover {
    border-color: var(--rose); background: rgba(242,215,222,0.3); transform: scale(1.005);
  }
  .upload-zone input[type="file"] {
    position: absolute; inset: 0; opacity: 0; cursor: pointer; width: 100%; height: 100%;
  }
  .upload-icon { font-size: 3rem; margin-bottom: 12px; display: block; }
  .upload-text { font-family: 'Playfair Display', serif; font-size: 1.2rem; color: var(--rose); margin-bottom: 6px; }
  .upload-hint { font-size: 0.85rem; color: var(--muted); }

  .caption-input-group { display: flex; gap: 10px; margin-top: 16px; }
  .caption-input-group input {
    flex: 1; padding: 11px 16px;
    border: 1.5px solid rgba(201,80,106,0.2); border-radius: 10px;
    font-family: 'Cormorant Garamond', serif; font-size: 1rem; font-style: italic;
    color: var(--dark); background: #fff; outline: none;
  }
  .caption-input-group input:focus { border-color: var(--rose); }

  .pw-manager {
    margin-top: 28px;
    border: 1px solid rgba(201,80,106,0.18);
    border-radius: 20px;
    background: rgba(255,255,255,0.7);
    backdrop-filter: blur(10px);
    overflow: hidden;
    box-shadow: 0 4px 24px rgba(201,80,106,0.07);
  }

  .pw-manager-header {
    padding: 18px 24px;
    border-bottom: 1px solid rgba(201,80,106,0.12);
    display: flex; align-items: center; justify-content: space-between;
    cursor: pointer; user-select: none;
    transition: background 0.2s;
  }
  .pw-manager-header:hover { background: rgba(242,215,222,0.3); }

  .pw-manager-title {
    font-family: 'Playfair Display', serif;
    font-size: 1rem; color: var(--rose); font-style: italic;
    display: flex; align-items: center; gap: 8px;
  }
  .pw-manager-title span { font-size: 1.1rem; }

  .pw-toggle-icon {
    font-size: 0.8rem; color: var(--muted);
    transition: transform 0.3s;
  }
  .pw-toggle-icon.open { transform: rotate(180deg); }

  .pw-manager-body {
    display: none; padding: 24px;
    animation: slideDown 0.3s ease;
  }
  .pw-manager-body.open { display: block; }
  @keyframes slideDown {
    from { opacity: 0; transform: translateY(-8px); }
    to   { opacity: 1; transform: translateY(0); }
  }

  .pw-row {
    display: grid; grid-template-columns: 1fr 1fr;
    gap: 20px; margin-bottom: 20px;
  }
  @media (max-width: 580px) { .pw-row { grid-template-columns: 1fr; } }

  .pw-field { position: relative; }
  .pw-field label {
    display: block; font-size: 0.7rem; letter-spacing: 0.1em;
    text-transform: uppercase; color: var(--muted); margin-bottom: 7px;
  }
  .pw-field-inner { position: relative; }
  .pw-field input {
    width: 100%; padding: 11px 40px 11px 14px;
    border: 1.5px solid rgba(201,80,106,0.2); border-radius: 10px;
    font-family: 'Lato', sans-serif; font-size: 0.9rem; color: var(--dark);
    background: var(--cream); outline: none;
    transition: border-color 0.2s, box-shadow 0.2s;
  }
  .pw-field input:focus {
    border-color: var(--rose); box-shadow: 0 0 0 3px rgba(201,80,106,0.1);
  }

  .eye-btn {
    position: absolute; right: 12px; top: 50%; transform: translateY(-50%);
    background: none; border: none; cursor: pointer;
    color: var(--muted); font-size: 0.9rem; padding: 2px;
    transition: color 0.2s; line-height: 1;
  }
  .eye-btn:hover { color: var(--rose); }

  .pw-current {
    font-size: 0.75rem; color: var(--muted);
    margin-top: 6px; font-style: italic;
    display: flex; align-items: center; gap: 5px;
  }
  .pw-current-val {
    font-family: 'Lato', sans-serif; letter-spacing: 0.12em;
    color: var(--dark); font-style: normal;
    background: var(--petal); padding: 2px 8px; border-radius: 6px;
    font-size: 0.78rem;
  }

  .pw-save-btn {
    width: 100%; padding: 13px;
    background: linear-gradient(135deg, var(--rose), #e07090);
    color: #fff; border: none; border-radius: 12px;
    font-family: 'Lato', sans-serif; font-size: 0.85rem;
    letter-spacing: 0.1em; text-transform: uppercase;
    cursor: pointer; transition: all 0.25s;
    box-shadow: 0 4px 16px rgba(201,80,106,0.25);
  }
  .pw-save-btn:hover { transform: translateY(-2px); box-shadow: 0 8px 24px rgba(201,80,106,0.35); }

  .pw-success {
    text-align: center; margin-top: 12px;
    font-family: 'Cormorant Garamond', serif; font-style: italic;
    font-size: 0.95rem; color: #5a9e6f; min-height: 20px;
    animation: fadeInMsg 0.4s ease;
  }
  .pw-error {
    text-align: center; margin-top: 12px;
    font-family: 'Cormorant Garamond', serif; font-style: italic;
    font-size: 0.95rem; color: var(--rose); min-height: 20px;
  }
  @keyframes fadeInMsg { from{opacity:0;} to{opacity:1;} }

  .gallery-section { max-width: 1200px; margin: 0 auto; padding: 0 24px 100px; }
  .gallery-section h2 {
    font-family: 'Playfair Display', serif; font-size: 1.6rem;
    color: var(--dark); margin-bottom: 36px; text-align: center; font-style: italic;
  }
  .gallery-grid { columns: 3; column-gap: 20px; }
  @media (max-width: 900px) { .gallery-grid { columns: 2; } }
  @media (max-width: 560px) { .gallery-grid { columns: 1; } }

  .photo-card {
    break-inside: avoid; margin-bottom: 20px; background: #fff;
    border-radius: 16px; overflow: hidden;
    box-shadow: 0 4px 20px rgba(44,26,31,0.07), 0 1px 4px rgba(44,26,31,0.05);
    position: relative; cursor: pointer; opacity: 0;
    transition: transform 0.3s cubic-bezier(0.34,1.56,0.64,1), box-shadow 0.3s;
    animation: cardIn 0.6s cubic-bezier(0.22,1,0.36,1) both;
  }
  .photo-card.visible { opacity: 1; }
  @keyframes cardIn {
    from { opacity: 0; transform: translateY(30px) scale(0.95); }
    to   { opacity: 1; transform: translateY(0) scale(1); }
  }
  .photo-card:hover {
    transform: translateY(-6px) scale(1.01);
    box-shadow: 0 16px 48px rgba(44,26,31,0.13), 0 4px 12px rgba(201,80,106,0.1);
  }
  .photo-card img { width: 100%; display: block; object-fit: cover; }
  .photo-card-footer { padding: 14px 18px 16px; }
  .photo-caption {
    font-family: 'Cormorant Garamond', serif; font-size: 1.05rem;
    font-style: italic; color: var(--dark); line-height: 1.5;
  }
  .photo-date { font-size: 0.72rem; color: var(--muted); margin-top: 5px; letter-spacing: 0.05em; }

  .photo-card-actions { position: absolute; top: 10px; right: 10px; display: none; gap: 6px; }
  .admin-mode .photo-card:hover .photo-card-actions { display: flex; }
  .del-btn {
    background: rgba(201,80,106,0.85); color: #fff; border: none;
    border-radius: 8px; padding: 5px 10px; font-size: 0.75rem;
    cursor: pointer; transition: background 0.2s;
  }
  .del-btn:hover { background: var(--rose); }

  #lightbox {
    position: fixed; inset: 0; z-index: 200;
    background: rgba(28,10,14,0.92); backdrop-filter: blur(10px);
    display: none; align-items: center; justify-content: center; padding: 24px;
  }
  #lightbox.open { display: flex; animation: fadeIn2 0.2s ease; }
  @keyframes fadeIn2 { from{opacity:0;} to{opacity:1;} }

  .lb-inner { position: relative; max-width: 880px; width: 100%; animation: lbIn 0.35s cubic-bezier(0.22,1,0.36,1); }
  @keyframes lbIn { from{transform:scale(0.88);opacity:0;} to{transform:scale(1);opacity:1;} }
  #lb-img { width:100%; max-height:78vh; object-fit:contain; border-radius:16px; display:block; }
  #lb-caption {
    font-family:'Cormorant Garamond',serif; font-size:1.35rem; font-style:italic;
    color:rgba(255,255,255,0.88); text-align:center; margin-top:20px; line-height:1.5;
  }
  .lb-close {
    position:absolute; top:-44px; right:0; background:none; border:none;
    color:rgba(255,255,255,0.6); font-size:1.8rem; cursor:pointer;
    line-height:1; transition:color 0.2s, transform 0.2s;
  }
  .lb-close:hover { color:#fff; transform:rotate(90deg); }
  .lb-nav {
    position:absolute; top:50%; transform:translateY(-50%);
    background:rgba(255,255,255,0.12); border:none; color:#fff;
    width:48px; height:48px; border-radius:50%; font-size:1.3rem;
    cursor:pointer; transition:background 0.2s;
    display:flex; align-items:center; justify-content:center;
  }
  .lb-nav:hover { background:rgba(201,80,106,0.5); }
  .lb-prev{left:-64px;} .lb-next{right:-64px;}
  @media(max-width:700px){.lb-prev{left:8px;}.lb-next{right:8px;}}

  .empty-gallery { text-align:center; padding:80px 24px; color:var(--muted); }
  .empty-gallery .big-icon { font-size:4rem; margin-bottom:16px; display:block; opacity:0.4; }
  .empty-gallery p { font-family:'Cormorant Garamond',serif; font-size:1.2rem; font-style:italic; }

  footer {
    text-align:center; padding:32px;
    border-top:1px solid rgba(201,80,106,0.1);
    font-family:'Cormorant Garamond',serif; font-size:1rem;
    color:var(--muted); font-style:italic; letter-spacing:0.04em;
    position:relative; z-index:1;
  }

  #message-banner {
    position:fixed; top:88px; left:50%; transform:translateX(-50%);
    background:linear-gradient(135deg,#fff0f3,#fff);
    border:1px solid rgba(201,80,106,0.25); border-radius:14px;
    padding:16px 28px; box-shadow:0 8px 30px rgba(201,80,106,0.15);
    z-index:999; display:none;
    font-family:'Cormorant Garamond',serif; font-size:1.1rem;
    font-style:italic; color:var(--rose); white-space:nowrap;
    animation:slideDownBanner 0.4s cubic-bezier(0.22,1,0.36,1);
  }
  @keyframes slideDownBanner {
    from{transform:translateX(-50%) translateY(-20px);opacity:0;}
    to{transform:translateX(-50%) translateY(0);opacity:1;}
  }
</style>
</head>
<body>

<canvas id="petals-canvas"></canvas>

<!-- LOGIN -->
<div id="login-screen">
  <div class="login-box">
    <span class="login-heart">â™¡</span>
    <h1 class="login-title">For You</h1>
    <p class="login-subtitle">A little world made just for you</p>
    <div class="tab-group">
      <button class="tab-btn active" onclick="switchTab('admin')">My View</button>
      <button class="tab-btn" onclick="switchTab('viewer')">Her View</button>
    </div>
    <div class="login-field">
      <label>Password</label>
      <input type="password" id="pw-input" placeholder="Enter password..." onkeydown="if(event.key==='Enter') doLogin()"/>
    </div>
    <button class="login-btn" onclick="doLogin()">
      <span id="login-btn-text">Enter â™¡</span>
      <span id="login-spinner" style="display:none;" class="spinner"></span>
    </button>
    <p class="login-error" id="login-error"></p>
    <a class="forgot-link" id="forgot-link" style="display:none;" onclick="openResetModal()">Forgot password?</a>
  </div>
</div>

<!-- RESET PASSWORD MODAL -->
<div id="reset-modal">
  <div class="reset-box">
    <button class="reset-close" onclick="closeResetModal()">âœ•</button>
    <span class="reset-icon">ğŸ”</span>
    <h2 class="reset-title" id="reset-title">Reset Password</h2>
    <p class="reset-subtitle" id="reset-subtitle">We'll send a code to your email</p>

    <div class="reset-steps">
      <div class="reset-step active" id="step-1">1</div>
      <div class="reset-step" id="step-2">2</div>
      <div class="reset-step" id="step-3">3</div>
    </div>

    <!-- Step 1: Request Code -->
    <div id="reset-step-1">
      <div class="reset-field">
        <label>Your Email</label>
        <input type="email" id="reset-email" placeholder="Enter your admin email..."/>
      </div>
      <button class="reset-btn" onclick="sendResetCode()">
        <span id="send-btn-text">Send Code â™¡</span>
        <span id="send-spinner" style="display:none;" class="spinner"></span>
      </button>
    </div>

    <!-- Step 2: Enter Code -->
    <div id="reset-step-2" style="display:none;">
      <div class="reset-field">
        <label>Enter 6-Digit Code</label>
        <input type="text" id="reset-code" class="reset-code-input" placeholder="000000" maxlength="6"/>
      </div>
      <button class="reset-btn" onclick="verifyCode()">
        <span id="verify-btn-text">Verify Code</span>
        <span id="verify-spinner" style="display:none;" class="spinner"></span>
      </button>
    </div>

    <!-- Step 3: New Password -->
    <div id="reset-step-3" style="display:none;">
      <div class="reset-field">
        <label>New Password</label>
        <input type="password" id="reset-new-pw" placeholder="Enter new password..."/>
      </div>
      <div class="reset-field">
        <label>Confirm Password</label>
        <input type="password" id="reset-confirm-pw" placeholder="Confirm new password..."/>
      </div>
      <button class="reset-btn" onclick="updatePassword()">
        <span id="update-btn-text">Update Password â™¡</span>
        <span id="update-spinner" style="display:none;" class="spinner"></span>
      </button>
    </div>

    <p class="reset-message" id="reset-message"></p>
  </div>
</div>

<!-- MAIN SITE (same as before) -->
<div id="main-site">
  <header>
    <div class="header-brand">For You â™¡</div>
    <div class="header-right">
      <span class="role-badge" id="role-badge">viewer</span>
      <button class="logout-btn" onclick="location.reload()">â† Leave</button>
    </div>
  </header>

  <section class="hero">
    <span class="hero-eyebrow">âœ¦ A Collection Made With Love âœ¦</span>
    <h1 class="hero-title">Every photo of<br><em>you</em> is magic</h1>
    <p class="hero-subtitle" id="hero-subtitle-text">Scroll through and see yourself through my eyes â€” beautiful, always.</p>
    <div class="hero-divider">â™¡</div>
  </section>

  <div id="admin-panel">
    <div class="upload-zone" id="drop-zone">
      <input type="file" id="file-input" accept="image/*" multiple onchange="handleFiles(this.files)"/>
      <span class="upload-icon">ğŸ“·</span>
      <p class="upload-text">Drop photos here or click to choose</p>
      <p class="upload-hint">JPG, PNG, WEBP â€” as many as you like</p>
    </div>
    <div class="caption-input-group">
      <input type="text" id="caption-input" placeholder="Add a caption for the next photo..."/>
    </div>

    <div class="pw-manager">
      <div class="pw-manager-header" onclick="togglePwManager()">
        <div class="pw-manager-title">
          <span>ğŸ”</span> Manage Passwords
        </div>
        <span class="pw-toggle-icon" id="pw-toggle-icon">â–¼</span>
      </div>
      <div class="pw-manager-body" id="pw-manager-body">
        <div class="pw-row">
          <div class="pw-field">
            <label>My Password (Admin)</label>
            <div class="pw-field-inner">
              <input type="password" id="new-admin-pw" placeholder="New admin password..."/>
              <button class="eye-btn" onclick="toggleEye('new-admin-pw', this)">ğŸ‘</button>
            </div>
            <div class="pw-current">
              Current: <span class="pw-current-val" id="show-admin-pw">â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢</span>
              <button class="eye-btn" style="position:static;transform:none;font-size:0.8rem;" onclick="revealCurrent('admin')">ğŸ‘</button>
            </div>
          </div>
          <div class="pw-field">
            <label>Her Password (Viewer)</label>
            <div class="pw-field-inner">
              <input type="password" id="new-viewer-pw" placeholder="New viewer password..."/>
              <button class="eye-btn" onclick="toggleEye('new-viewer-pw', this)">ğŸ‘</button>
            </div>
            <div class="pw-current">
              Current: <span class="pw-current-val" id="show-viewer-pw">â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢</span>
              <button class="eye-btn" style="position:static;transform:none;font-size:0.8rem;" onclick="revealCurrent('viewer')">ğŸ‘</button>
            </div>
          </div>
        </div>
        <button class="pw-save-btn" onclick="savePasswords()">Save Passwords â™¡</button>
        <p class="pw-success" id="pw-success"></p>
        <p class="pw-error"   id="pw-error"></p>
      </div>
    </div>
  </div>

  <section class="gallery-section">
    <h2>Our Moments Together</h2>
    <div class="gallery-grid" id="gallery-grid"></div>
    <div class="empty-gallery" id="empty-state">
      <span class="big-icon">ğŸŒ¸</span>
      <p>Photos will bloom here soon...</p>
    </div>
  </section>

  <footer>Made with â™¡ just for you â€” every picture, every memory, all yours.</footer>
</div>

<div id="lightbox" onclick="closeLightbox(event)">
  <div class="lb-inner">
    <button class="lb-close" onclick="closeLightbox()">âœ•</button>
    <button class="lb-nav lb-prev" onclick="lbNavigate(-1);event.stopPropagation()">â€¹</button>
    <button class="lb-nav lb-next" onclick="lbNavigate(1);event.stopPropagation()">â€º</button>
    <img id="lb-img" src="" alt=""/>
    <p id="lb-caption"></p>
  </div>
</div>

<div id="message-banner"></div>

<script>
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// ğŸ”¥ CONFIGURATION - PASTE YOUR KEYS HERE!
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

// SUPABASE (Required)
const SUPABASE_URL = 'https://xfudvpspcfhycnaamtsr.supabase.co';  // â† From Supabase dashboard
const SUPABASE_KEY = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InhmdWR2cHNwY2ZoeWNuYWFtdHNyIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NzE0MjI3NzQsImV4cCI6MjA4Njk5ODc3NH0.8RBcjjs001B9wmbSWnZVl6o2JNlhugRq1NEGatDV-gc';      // â† From Supabase dashboard

// EMAIL SERVICE - Choose ONE option below:

// OPTION A: RESEND (Recommended - easier setup)
const EMAIL_SERVICE = 'resend';
const RESEND_API_KEY = 're_4YcoGWs6_89kmXFPgM8qWUMtQLogrtzoZ';  // â† Starts with re_...
const FROM_EMAIL = 'onboarding@resend.dev';  // â† Use this for testing, or your verified domain

// OPTION B: EMAILJS (Alternative)
// const EMAIL_SERVICE = 'emailjs';
// const EMAILJS_SERVICE_ID = 'YOUR_SERVICE_ID';
// const EMAILJS_TEMPLATE_ID = 'YOUR_TEMPLATE_ID';
// const EMAILJS_PUBLIC_KEY = 'YOUR_PUBLIC_KEY';

// Your admin email (where reset codes will be sent)
const ADMIN_EMAIL = 'imrank32646@gmail.com';  // â† CHANGE THIS TO YOUR EMAIL!

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

const supabase = window.supabase.createClient(SUPABASE_URL, SUPABASE_KEY);

const LOVE_NOTE_FOR_HER   = "I made this just for you â™¡ Every photo here is proof of how beautiful you are to me.";
const HERO_SUBTITLE_ADMIN = "You're the curator of her heart â€” add all the beautiful moments.";

let currentTab = 'admin';
let photos = [];
let lbIndex = 0;
let currentPasswords = { admin: 'myadmin123', viewer: 'hername2025', adminEmail: ADMIN_EMAIL };
let resetCodeData = null;

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// PETALS (same as before)
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
const canvas = document.getElementById('petals-canvas');
const ctx = canvas.getContext('2d');
let petals = [];
function resizeCanvas() { canvas.width = innerWidth; canvas.height = innerHeight; }
function createPetal() {
  return { x: Math.random()*canvas.width, y: -20, size: 6+Math.random()*10,
    speedY: 0.6+Math.random()*1.2, speedX: (Math.random()-0.5)*0.6,
    rotation: Math.random()*Math.PI*2, rotSpeed: (Math.random()-0.5)*0.04,
    opacity: 0.3+Math.random()*0.5, hue: 340+Math.random()*20 };
}
function drawPetals() {
  ctx.clearRect(0,0,canvas.width,canvas.height);
  if(petals.length<18) petals.push(createPetal());
  petals = petals.filter(p=>p.y<canvas.height+30);
  petals.forEach(p=>{
    p.y+=p.speedY; p.x+=p.speedX+Math.sin(p.y*0.015)*0.5; p.rotation+=p.rotSpeed;
    ctx.save(); ctx.translate(p.x,p.y); ctx.rotate(p.rotation);
    ctx.globalAlpha=p.opacity; ctx.fillStyle=`hsl(${p.hue},70%,78%)`;
    ctx.beginPath(); ctx.ellipse(0,0,p.size*0.55,p.size,0,0,Math.PI*2); ctx.fill(); ctx.restore();
  });
  requestAnimationFrame(drawPetals);
}
resizeCanvas(); addEventListener('resize',resizeCanvas); drawPetals();

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// DATABASE FUNCTIONS
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
async function loadPasswords() {
  try {
    const { data, error } = await supabase.from('passwords').select('*').eq('id', 'main').single();
    if (error) throw error;
    if (data) {
      currentPasswords = { 
        admin: data.admin_password, 
        viewer: data.viewer_password,
        adminEmail: data.admin_email || ADMIN_EMAIL
      };
    }
  } catch (e) {
    console.error('Error loading passwords:', e);
  }
}

async function loadPhotos() {
  try {
    const { data, error } = await supabase.from('photos').select('*').order('created_at', { ascending: false });
    if (error) throw error;
    photos = data || [];
    renderGallery();
  } catch (e) {
    console.error('Error loading photos:', e);
  }
}

async function addPhotoToDB(photo) {
  try {
    const { error } = await supabase.from('photos').insert([photo]);
    if (error) throw error;
    await loadPhotos();
  } catch (e) {
    console.error('Error adding photo:', e);
    alert('Failed to upload photo. Please try again.');
  }
}

async function deletePhotoFromDB(id) {
  try {
    const { error } = await supabase.from('photos').delete().eq('id', id);
    if (error) throw error;
    await loadPhotos();
  } catch (e) {
    console.error('Error deleting photo:', e);
  }
}

async function updatePasswordsInDB(adminPw, viewerPw) {
  try {
    const updates = {};
    if (adminPw) updates.admin_password = adminPw;
    if (viewerPw) updates.viewer_password = viewerPw;
    updates.updated_at = new Date().toISOString();

    const { error } = await supabase.from('passwords').update(updates).eq('id', 'main');
    if (error) throw error;
    await loadPasswords();
    return true;
  } catch (e) {
    console.error('Error updating passwords:', e);
    return false;
  }
}

(async () => {
  await loadPasswords();
  await loadPhotos();
})();

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// EMAIL FUNCTIONS
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
async function sendEmailWithCode(email, code) {
  if (EMAIL_SERVICE === 'resend') {
    try {
      const response = await fetch('https://api.resend.com/emails', {
        method: 'POST',
        headers: {
          'Authorization': `Bearer ${RESEND_API_KEY}`,
          'Content-Type': 'application/json'
        },
        body: JSON.stringify({
          from: FROM_EMAIL,
          to: [email],
          subject: 'Password Reset Code - For You â™¡',
          html: `
            <div style="font-family: Georgia, serif; max-width: 500px; margin: 0 auto; padding: 40px; background: #fdf6f0; border-radius: 16px;">
              <h1 style="color: #c9506a; font-size: 28px; margin-bottom: 16px; text-align: center;">Password Reset â™¡</h1>
              <p style="color: #2c1a1f; font-size: 16px; line-height: 1.6; margin-bottom: 24px;">Your password reset code is:</p>
              <div style="background: white; border: 2px solid #c9506a; border-radius: 12px; padding: 20px; text-align: center; margin-bottom: 24px;">
                <span style="font-size: 32px; letter-spacing: 8px; font-weight: bold; color: #c9506a;">${code}</span>
              </div>
              <p style="color: #9a7b82; font-size: 14px; line-height: 1.5;">This code expires in 15 minutes. If you didn't request this, please ignore this email.</p>
            </div>
          `
        })
      });
      return response.ok;
    } catch (e) {
      console.error('Resend error:', e);
      return false;
    }
  } else if (EMAIL_SERVICE === 'emailjs') {
    try {
      const response = await fetch('https://api.emailjs.com/api/v1.0/email/send', {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify({
          service_id: EMAILJS_SERVICE_ID,
          template_id: EMAILJS_TEMPLATE_ID,
          user_id: EMAILJS_PUBLIC_KEY,
          template_params: {
            to_email: email,
            code: code
          }
        })
      });
      return response.ok;
    } catch (e) {
      console.error('EmailJS error:', e);
      return false;
    }
  }
  return false;
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// PASSWORD RESET FLOW
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function openResetModal() {
  document.getElementById('reset-modal').classList.add('open');
  const emailVal = (currentPasswords && currentPasswords.adminEmail) ? currentPasswords.adminEmail : '';
  document.getElementById('reset-email').value = emailVal !== ADMIN_EMAIL ? emailVal : '';
}

function closeResetModal() {
  document.getElementById('reset-modal').classList.remove('open');
  // Reset to step 1
  document.getElementById('reset-step-1').style.display = 'block';
  document.getElementById('reset-step-2').style.display = 'none';
  document.getElementById('reset-step-3').style.display = 'none';
  document.getElementById('step-1').classList.add('active');
  document.getElementById('step-2').classList.remove('active','done');
  document.getElementById('step-3').classList.remove('active','done');
  document.getElementById('reset-message').textContent = '';
  document.getElementById('reset-message').className = 'reset-message';
  resetCodeData = null;
}

async function sendResetCode() {
  const email = document.getElementById('reset-email').value.trim();
  const msg = document.getElementById('reset-message');
  const btnText = document.getElementById('send-btn-text');
  const spinner = document.getElementById('send-spinner');
  
  msg.textContent = ''; msg.className = 'reset-message';
  
  if (!email) {
    msg.textContent = 'Please enter your email â™¡';
    msg.classList.add('error');
    return;
  }
  if (!email.includes('@')) {
    msg.textContent = 'Please enter a valid email â™¡';
    msg.classList.add('error');
    return;
  }
  
  btnText.style.display = 'none';
  spinner.style.display = 'inline-block';
  
  // Generate 6-digit code
  const code = Math.floor(100000 + Math.random() * 900000).toString();
  const expiresAt = new Date(Date.now() + 15 * 60 * 1000).toISOString(); // 15 min
  
  try {
    // Save code to database
    const { data, error } = await supabase.from('reset_codes').insert([{
      email: email,
      code: code,
      expires_at: expiresAt,
      used: false
    }]).select().single();
    
    if (error) throw error;
    
    // Send email
    const sent = await sendEmailWithCode(email, code);
    
    if (!sent) {
      throw new Error('Failed to send email');
    }
    
    resetCodeData = data;
    
    // Move to step 2
    document.getElementById('reset-step-1').style.display = 'none';
    document.getElementById('reset-step-2').style.display = 'block';
    document.getElementById('step-1').classList.remove('active');
    document.getElementById('step-1').classList.add('done');
    document.getElementById('step-2').classList.add('active');
    document.getElementById('reset-title').textContent = 'Check Your Email';
    document.getElementById('reset-subtitle').textContent = `We sent a code to ${email}`;
    
    msg.textContent = 'âœ“ Code sent! Check your email (and spam folder)';
    msg.classList.add('success');
    
  } catch (e) {
    console.error('Reset error:', e);
    msg.textContent = 'Failed to send code. Please try again â™¡';
    msg.classList.add('error');
  } finally {
    btnText.style.display = 'inline';
    spinner.style.display = 'none';
  }
}

async function verifyCode() {
  const code = document.getElementById('reset-code').value.trim();
  const msg = document.getElementById('reset-message');
  const btnText = document.getElementById('verify-btn-text');
  const spinner = document.getElementById('verify-spinner');
  
  msg.textContent = ''; msg.className = 'reset-message';
  
  if (!code || code.length !== 6) {
    msg.textContent = 'Please enter the 6-digit code â™¡';
    msg.classList.add('error');
    return;
  }

  if (!resetCodeData || !resetCodeData.id) {
    msg.textContent = 'Session expired. Please request a new code â™¡';
    msg.classList.add('error');
    return;
  }
  
  btnText.style.display = 'none';
  spinner.style.display = 'inline-block';
  
  try {
    // Check code in database
    const { data, error } = await supabase
      .from('reset_codes')
      .select('*')
      .eq('id', resetCodeData.id)
      .eq('code', code)
      .eq('used', false)
      .single();
    
    if (error || !data) {
      msg.textContent = 'Invalid code. Please try again â™¡';
      msg.classList.add('error');
      btnText.style.display = 'inline';
      spinner.style.display = 'none';
      return;
    }
    
    // Check expiry
    if (new Date(data.expires_at) < new Date()) {
      msg.textContent = 'Code expired. Please request a new one â™¡';
      msg.classList.add('error');
      btnText.style.display = 'inline';
      spinner.style.display = 'none';
      return;
    }
    
    // Move to step 3
    document.getElementById('reset-step-2').style.display = 'none';
    document.getElementById('reset-step-3').style.display = 'block';
    document.getElementById('step-2').classList.remove('active');
    document.getElementById('step-2').classList.add('done');
    document.getElementById('step-3').classList.add('active');
    document.getElementById('reset-title').textContent = 'Create New Password';
    document.getElementById('reset-subtitle').textContent = 'Choose a strong password';
    
  } catch (e) {
    console.error('Verify error:', e);
    msg.textContent = 'Something went wrong. Please try again â™¡';
    msg.classList.add('error');
  } finally {
    btnText.style.display = 'inline';
    spinner.style.display = 'none';
  }
}

async function updatePassword() {
  const newPw = document.getElementById('reset-new-pw').value.trim();
  const confirmPw = document.getElementById('reset-confirm-pw').value.trim();
  const msg = document.getElementById('reset-message');
  const btnText = document.getElementById('update-btn-text');
  const spinner = document.getElementById('update-spinner');
  
  msg.textContent = ''; msg.className = 'reset-message';
  
  if (!newPw || !confirmPw) {
    msg.textContent = 'Please fill in both fields â™¡';
    msg.classList.add('error');
    return;
  }
  if (newPw.length < 4) {
    msg.textContent = 'Password must be at least 4 characters â™¡';
    msg.classList.add('error');
    return;
  }
  if (newPw !== confirmPw) {
    msg.textContent = 'Passwords don\'t match â™¡';
    msg.classList.add('error');
    return;
  }
  
  btnText.style.display = 'none';
  spinner.style.display = 'inline-block';
  
  try {
    // Update password in database
    const { error: pwError } = await supabase
      .from('passwords')
      .update({ admin_password: newPw, updated_at: new Date().toISOString() })
      .eq('id', 'main');
    
    if (pwError) throw pwError;
    
    // Mark code as used
    await supabase
      .from('reset_codes')
      .update({ used: true })
      .eq('id', resetCodeData.id);
    
    await loadPasswords();
    
    document.getElementById('step-3').classList.remove('active');
    document.getElementById('step-3').classList.add('done');
    
    msg.textContent = 'âœ“ Password updated successfully! You can now login â™¡';
    msg.classList.add('success');
    
    setTimeout(() => {
      closeResetModal();
    }, 2000);
    
  } catch (e) {
    console.error('Update error:', e);
    msg.textContent = 'Failed to update password. Please try again â™¡';
    msg.classList.add('error');
  } finally {
    btnText.style.display = 'inline';
    spinner.style.display = 'none';
  }
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// LOGIN
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function switchTab(role) {
  currentTab = role;
  document.querySelectorAll('.tab-btn').forEach((b,i)=>
    b.classList.toggle('active',(role==='admin'&&i===0)||(role==='viewer'&&i===1)));
  document.getElementById('login-error').textContent='';
  // Show forgot link only for admin
  document.getElementById('forgot-link').style.display = role==='admin' ? 'block' : 'none';
}

async function doLogin() {
  const pw  = document.getElementById('pw-input').value.trim();
  const err = document.getElementById('login-error');
  const btnText = document.getElementById('login-btn-text');
  const spinner = document.getElementById('login-spinner');

  btnText.style.display = 'none';
  spinner.style.display = 'inline-block';

  await new Promise(r => setTimeout(r, 300));

  if(currentTab==='admin'  && pw===currentPasswords.admin)  { 
    enterSite('admin'); 
    return; 
  }
  if(currentTab==='viewer' && pw===currentPasswords.viewer) { 
    enterSite('viewer'); 
    return; 
  }

  btnText.style.display = 'inline';
  spinner.style.display = 'none';
  err.textContent = "Hmm, that doesn't seem right â™¡";
  document.getElementById('pw-input').value='';
}

function enterSite(role) {
  const ls = document.getElementById('login-screen');
  ls.style.opacity='0'; ls.style.transition='opacity 0.6s';
  setTimeout(()=>{
    ls.style.display='none';
    const ms = document.getElementById('main-site');
    ms.style.display='block';
    document.getElementById('role-badge').textContent = role==='admin'?'âœ¦ admin':'â™¡ viewer';
    if(role==='admin'){
      document.getElementById('admin-panel').style.display='block';
      ms.classList.add('admin-mode');
      document.getElementById('hero-subtitle-text').textContent=HERO_SUBTITLE_ADMIN;
    } else {
      showBanner(LOVE_NOTE_FOR_HER);
    }
    setupDragDrop();
  },600);
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// PASSWORD MANAGER (same as before)
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function togglePwManager() {
  const body = document.getElementById('pw-manager-body');
  const icon = document.getElementById('pw-toggle-icon');
  const isOpen = body.classList.toggle('open');
  icon.classList.toggle('open', isOpen);
}

function toggleEye(inputId, btn) {
  const inp = document.getElementById(inputId);
  if(inp.type==='password'){ inp.type='text'; btn.textContent='ğŸ™ˆ'; }
  else { inp.type='password'; btn.textContent='ğŸ‘'; }
}

let adminRevealed  = false;
let viewerRevealed = false;
function revealCurrent(who) {
  if(who==='admin'){
    adminRevealed = !adminRevealed;
    document.getElementById('show-admin-pw').textContent = adminRevealed ? currentPasswords.admin : 'â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢';
  } else {
    viewerRevealed = !viewerRevealed;
    document.getElementById('show-viewer-pw').textContent = viewerRevealed ? currentPasswords.viewer : 'â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢';
  }
}

async function savePasswords() {
  const newAdmin  = document.getElementById('new-admin-pw').value.trim();
  const newViewer = document.getElementById('new-viewer-pw').value.trim();
  const success   = document.getElementById('pw-success');
  const error     = document.getElementById('pw-error');
  success.textContent=''; error.textContent='';

  if(!newAdmin && !newViewer) {
    error.textContent = 'Please enter at least one new password â™¡';
    return;
  }
  if(newAdmin && newAdmin.length < 4) {
    error.textContent = 'Admin password must be at least 4 characters â™¡';
    return;
  }
  if(newViewer && newViewer.length < 4) {
    error.textContent = 'Her password must be at least 4 characters â™¡';
    return;
  }

  const updated = await updatePasswordsInDB(newAdmin, newViewer);
  if(!updated) {
    error.textContent = 'Failed to update passwords. Please try again â™¡';
    return;
  }

  document.getElementById('new-admin-pw').value='';
  document.getElementById('new-viewer-pw').value='';
  document.getElementById('new-admin-pw').type='password';
  document.getElementById('new-viewer-pw').type='password';
  adminRevealed=false; viewerRevealed=false;
  document.getElementById('show-admin-pw').textContent='â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢';
  document.getElementById('show-viewer-pw').textContent='â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢';

  let msg = '';
  if(newAdmin && newViewer) msg = 'âœ“ Both passwords updated on all devices â™¡';
  else if(newAdmin)  msg = 'âœ“ Your admin password updated on all devices â™¡';
  else               msg = 'âœ“ Her password updated on all devices â™¡';

  success.textContent = msg;
  setTimeout(()=>{ success.textContent=''; },4000);
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// DRAG & DROP, PHOTOS, GALLERY (same as before)
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function setupDragDrop() {
  const dz=document.getElementById('drop-zone'); if(!dz)return;
  dz.addEventListener('dragover',e=>{e.preventDefault();dz.classList.add('dragover');});
  dz.addEventListener('dragleave',()=>dz.classList.remove('dragover'));
  dz.addEventListener('drop',e=>{e.preventDefault();dz.classList.remove('dragover');handleFiles(e.dataTransfer.files);});
}

function handleFiles(fileList) {
  const cap = document.getElementById('caption-input').value.trim();
  Array.from(fileList).forEach(file=>{
    if(!file.type.startsWith('image/'))return;
    const reader=new FileReader();
    reader.onload=async (e)=>{
      const photo = {
        id: Date.now() + '-' + Math.random().toString(36).substr(2,9),
        src: e.target.result,
        caption: cap||'',
        date: new Date().toLocaleDateString('en-US',{month:'long',day:'numeric',year:'numeric'})
      };
      await addPhotoToDB(photo);
    };
    reader.readAsDataURL(file);
  });
  document.getElementById('caption-input').value='';
  document.getElementById('file-input').value='';
}

async function deletePhoto(id) {
  await deletePhotoFromDB(id);
}

function renderGallery() {
  const grid  = document.getElementById('gallery-grid');
  const empty = document.getElementById('empty-state');
  const isAdm = document.getElementById('main-site').classList.contains('admin-mode');
  grid.innerHTML='';
  empty.style.display = photos.length===0?'block':'none';
  photos.forEach((p,idx)=>{
    const card=document.createElement('div');
    card.className='photo-card';
    card.style.animationDelay=(idx*0.06)+'s';
    card.innerHTML=`
      <img src="${p.src}" alt="${p.caption}" loading="lazy" onclick="openLightbox(${idx})"/>
      ${(p.caption||p.date)?`<div class="photo-card-footer">
        ${p.caption?`<p class="photo-caption">${p.caption}</p>`:''}
        ${p.date?`<p class="photo-date">${p.date}</p>`:''}
      </div>`:''}
      ${isAdm?`<div class="photo-card-actions">
        <button class="del-btn" onclick="event.stopPropagation();deletePhoto('${p.id}')">Remove</button>
      </div>`:''}`;
    grid.appendChild(card);
  });
  const obs=new IntersectionObserver(entries=>entries.forEach(e=>{
    if(e.isIntersecting){e.target.classList.add('visible');obs.unobserve(e.target);}
  }),{threshold:0.1});
  grid.querySelectorAll('.photo-card').forEach(c=>obs.observe(c));
}

function openLightbox(idx) { lbIndex=idx; updateLb(); document.getElementById('lightbox').classList.add('open'); document.body.style.overflow='hidden'; }
function closeLightbox(e) { if(e&&e.target!==document.getElementById('lightbox'))return; document.getElementById('lightbox').classList.remove('open'); document.body.style.overflow=''; lbIndex=0; }
function updateLb() { const p=photos[lbIndex]; document.getElementById('lb-img').src=p.src; document.getElementById('lb-caption').textContent=p.caption||''; }
function lbNavigate(d) { lbIndex=(lbIndex+d+photos.length)%photos.length; updateLb(); }
document.addEventListener('keydown',e=>{
  if(!document.getElementById('lightbox').classList.contains('open'))return;
  if(e.key==='ArrowLeft'){e.preventDefault();lbNavigate(-1);}
  if(e.key==='ArrowRight'){e.preventDefault();lbNavigate(1);}
  if(e.key==='Escape'){document.getElementById('lightbox').classList.remove('open');document.body.style.overflow='';}
});

function showBanner(msg) {
  const b=document.getElementById('message-banner');
  b.textContent=msg; b.style.display='block';
  setTimeout(()=>{b.style.transition='opacity 0.8s';b.style.opacity='0';
    setTimeout(()=>{b.style.display='none';b.style.opacity='1';},800);},5000);
}

// Show forgot link for admin on page load
document.getElementById('forgot-link').style.display = 'block';
</script>
</body>
</html>