<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0"/>
<title>For You â™¡</title>
<link href="https://fonts.googleapis.com/css2?family=Playfair+Display:ital,wght@0,400;0,700;1,400;1,700&family=Cormorant+Garamond:ital,wght@0,300;0,400;1,300;1,400&family=Lato:wght@300;400&display=swap" rel="stylesheet"/>
<style>
  :root {
    --rose: #c9506a;
    --blush: #f2d7de;
    --petal: #f9eef1;
    --cream: #fdf6f0;
    --gold: #c9a96e;
    --dark: #2c1a1f;
    --muted: #9a7b82;
  }

  * { margin: 0; padding: 0; box-sizing: border-box; }

  body {
    font-family: 'Lato', sans-serif;
    background: var(--cream);
    color: var(--dark);
    min-height: 100vh;
    overflow-x: hidden;
  }

  #petals-canvas {
    position: fixed; top: 0; left: 0;
    width: 100%; height: 100%;
    pointer-events: none; z-index: 0; opacity: 0.35;
  }

  /* â”€â”€â”€ LOGIN â”€â”€â”€ */
  #login-screen {
    position: fixed; inset: 0; z-index: 100;
    display: flex; align-items: center; justify-content: center;
    background: linear-gradient(145deg, #fdf0f3 0%, #f9e8ee 40%, #f2d7de 100%);
  }

  .login-box {
    background: rgba(255,255,255,0.82);
    backdrop-filter: blur(16px);
    border: 1px solid rgba(201,80,106,0.18);
    border-radius: 24px;
    padding: 52px 44px 44px;
    width: 380px; max-width: 95vw;
    text-align: center;
    box-shadow: 0 32px 80px rgba(201,80,106,0.12), 0 4px 24px rgba(0,0,0,0.06);
    animation: floatIn 0.9s cubic-bezier(0.22,1,0.36,1) both;
  }
  @keyframes floatIn {
    from { opacity: 0; transform: translateY(40px) scale(0.96); }
    to   { opacity: 1; transform: translateY(0) scale(1); }
  }

  .login-heart {
    font-size: 3rem; display: block; margin-bottom: 12px;
    animation: heartbeat 2.2s ease-in-out infinite;
  }
  @keyframes heartbeat {
    0%,100% { transform: scale(1); }
    14% { transform: scale(1.18); }
    28% { transform: scale(1); }
    42% { transform: scale(1.12); }
    56% { transform: scale(1); }
  }

  .login-title {
    font-family: 'Playfair Display', serif;
    font-size: 2rem; color: var(--rose); margin-bottom: 4px; font-style: italic;
  }
  .login-subtitle {
    font-family: 'Cormorant Garamond', serif;
    font-size: 1rem; color: var(--muted); margin-bottom: 32px;
    font-style: italic; letter-spacing: 0.05em;
  }

  .tab-group {
    display: flex; border-radius: 12px; background: var(--petal);
    padding: 4px; margin-bottom: 24px; gap: 4px;
  }
  .tab-btn {
    flex: 1; padding: 9px; border: none; border-radius: 9px;
    background: transparent; cursor: pointer;
    font-family: 'Lato', sans-serif; font-size: 0.82rem;
    letter-spacing: 0.06em; text-transform: uppercase; color: var(--muted);
    transition: all 0.25s;
  }
  .tab-btn.active {
    background: #fff; color: var(--rose);
    box-shadow: 0 2px 8px rgba(201,80,106,0.12);
  }

  .login-field { margin-bottom: 16px; text-align: left; }
  .login-field label {
    display: block; font-size: 0.72rem; letter-spacing: 0.1em;
    text-transform: uppercase; color: var(--muted); margin-bottom: 7px;
  }
  .login-field input {
    width: 100%; padding: 13px 16px;
    border: 1.5px solid rgba(201,80,106,0.2); border-radius: 10px;
    background: rgba(255,255,255,0.9);
    font-family: 'Lato', sans-serif; font-size: 0.95rem; color: var(--dark);
    outline: none; transition: border-color 0.2s, box-shadow 0.2s;
  }
  .login-field input:focus {
    border-color: var(--rose); box-shadow: 0 0 0 3px rgba(201,80,106,0.1);
  }

  .login-btn {
    width: 100%; padding: 14px;
    background: linear-gradient(135deg, var(--rose) 0%, #e07090 100%);
    color: #fff; border: none; border-radius: 12px;
    font-family: 'Lato', sans-serif; font-size: 0.9rem;
    letter-spacing: 0.12em; text-transform: uppercase;
    cursor: pointer; margin-top: 8px; transition: all 0.25s;
    box-shadow: 0 6px 20px rgba(201,80,106,0.3);
  }
  .login-btn:hover { transform: translateY(-2px); box-shadow: 0 10px 28px rgba(201,80,106,0.38); }
  .login-error { color: var(--rose); font-size: 0.82rem; margin-top: 12px; min-height: 18px; font-style: italic; }

  /* â”€â”€â”€ MAIN â”€â”€â”€ */
  #main-site { display: none; position: relative; z-index: 1; }

  header {
    position: sticky; top: 0; z-index: 50;
    background: rgba(253,246,240,0.88); backdrop-filter: blur(18px);
    border-bottom: 1px solid rgba(201,80,106,0.1);
    padding: 0 40px; height: 68px;
    display: flex; align-items: center; justify-content: space-between;
  }
  .header-brand {
    font-family: 'Playfair Display', serif;
    font-size: 1.5rem; color: var(--rose); font-style: italic;
  }
  .header-right { display: flex; align-items: center; gap: 20px; }
  .role-badge {
    font-size: 0.72rem; letter-spacing: 0.1em; text-transform: uppercase;
    color: var(--muted); padding: 5px 12px;
    border: 1px solid rgba(201,80,106,0.25); border-radius: 100px;
  }
  .logout-btn {
    background: none; border: none; cursor: pointer; color: var(--muted);
    font-size: 0.8rem; letter-spacing: 0.06em; transition: color 0.2s;
    font-family: 'Lato', sans-serif;
  }
  .logout-btn:hover { color: var(--rose); }

  /* â”€â”€â”€ HERO â”€â”€â”€ */
  .hero { text-align: center; padding: 80px 24px 56px; position: relative; }
  .hero-eyebrow {
    font-family: 'Cormorant Garamond', serif; font-size: 1rem;
    color: var(--gold); letter-spacing: 0.22em; text-transform: uppercase;
    margin-bottom: 18px; display: block;
  }
  .hero-title {
    font-family: 'Playfair Display', serif;
    font-size: clamp(2.8rem, 7vw, 5.5rem); line-height: 1.12;
    color: var(--dark); margin-bottom: 20px;
  }
  .hero-title em { color: var(--rose); font-style: italic; }
  .hero-subtitle {
    font-family: 'Cormorant Garamond', serif; font-size: 1.25rem;
    color: var(--muted); max-width: 520px; margin: 0 auto 40px;
    line-height: 1.7; font-style: italic;
  }
  .hero-divider {
    display: flex; align-items: center; justify-content: center;
    gap: 14px; color: var(--rose); font-size: 1.1rem; opacity: 0.5;
  }
  .hero-divider::before, .hero-divider::after {
    content: ''; height: 1px; width: 60px;
    background: var(--rose); opacity: 0.3;
  }

  /* â”€â”€â”€ ADMIN PANEL â”€â”€â”€ */
  #admin-panel { max-width: 760px; margin: 0 auto 60px; padding: 0 24px; display: none; }

  /* â”€â”€â”€ UPLOAD ZONE â”€â”€â”€ */
  .upload-zone {
    border: 2px dashed rgba(201,80,106,0.3); border-radius: 20px;
    padding: 52px 32px; text-align: center;
    background: rgba(242,215,222,0.15);
    cursor: pointer; transition: all 0.25s; position: relative;
  }
  .upload-zone:hover, .upload-zone.dragover {
    border-color: var(--rose); background: rgba(242,215,222,0.3); transform: scale(1.005);
  }
  .upload-zone input[type="file"] {
    position: absolute; inset: 0; opacity: 0; cursor: pointer; width: 100%; height: 100%;
  }
  .upload-icon { font-size: 3rem; margin-bottom: 12px; display: block; }
  .upload-text { font-family: 'Playfair Display', serif; font-size: 1.2rem; color: var(--rose); margin-bottom: 6px; }
  .upload-hint { font-size: 0.85rem; color: var(--muted); }

  .caption-input-group { display: flex; gap: 10px; margin-top: 16px; }
  .caption-input-group input {
    flex: 1; padding: 11px 16px;
    border: 1.5px solid rgba(201,80,106,0.2); border-radius: 10px;
    font-family: 'Cormorant Garamond', serif; font-size: 1rem; font-style: italic;
    color: var(--dark); background: #fff; outline: none;
  }
  .caption-input-group input:focus { border-color: var(--rose); }

  /* â”€â”€â”€ PASSWORD MANAGER â”€â”€â”€ */
  .pw-manager {
    margin-top: 28px;
    border: 1px solid rgba(201,80,106,0.18);
    border-radius: 20px;
    background: rgba(255,255,255,0.7);
    backdrop-filter: blur(10px);
    overflow: hidden;
    box-shadow: 0 4px 24px rgba(201,80,106,0.07);
  }

  .pw-manager-header {
    padding: 18px 24px;
    border-bottom: 1px solid rgba(201,80,106,0.12);
    display: flex; align-items: center; justify-content: space-between;
    cursor: pointer; user-select: none;
    transition: background 0.2s;
  }
  .pw-manager-header:hover { background: rgba(242,215,222,0.3); }

  .pw-manager-title {
    font-family: 'Playfair Display', serif;
    font-size: 1rem; color: var(--rose); font-style: italic;
    display: flex; align-items: center; gap: 8px;
  }
  .pw-manager-title span { font-size: 1.1rem; }

  .pw-toggle-icon {
    font-size: 0.8rem; color: var(--muted);
    transition: transform 0.3s;
  }
  .pw-toggle-icon.open { transform: rotate(180deg); }

  .pw-manager-body {
    display: none; padding: 24px;
    animation: slideDown 0.3s ease;
  }
  .pw-manager-body.open { display: block; }
  @keyframes slideDown {
    from { opacity: 0; transform: translateY(-8px); }
    to   { opacity: 1; transform: translateY(0); }
  }

  .pw-row {
    display: grid; grid-template-columns: 1fr 1fr;
    gap: 20px; margin-bottom: 20px;
  }
  @media (max-width: 580px) { .pw-row { grid-template-columns: 1fr; } }

  .pw-field { position: relative; }
  .pw-field label {
    display: block; font-size: 0.7rem; letter-spacing: 0.1em;
    text-transform: uppercase; color: var(--muted); margin-bottom: 7px;
  }
  .pw-field-inner { position: relative; }
  .pw-field input {
    width: 100%; padding: 11px 40px 11px 14px;
    border: 1.5px solid rgba(201,80,106,0.2); border-radius: 10px;
    font-family: 'Lato', sans-serif; font-size: 0.9rem; color: var(--dark);
    background: var(--cream); outline: none;
    transition: border-color 0.2s, box-shadow 0.2s;
  }
  .pw-field input:focus {
    border-color: var(--rose); box-shadow: 0 0 0 3px rgba(201,80,106,0.1);
  }

  /* eye toggle */
  .eye-btn {
    position: absolute; right: 12px; top: 50%; transform: translateY(-50%);
    background: none; border: none; cursor: pointer;
    color: var(--muted); font-size: 0.9rem; padding: 2px;
    transition: color 0.2s; line-height: 1;
  }
  .eye-btn:hover { color: var(--rose); }

  .pw-current {
    font-size: 0.75rem; color: var(--muted);
    margin-top: 6px; font-style: italic;
    display: flex; align-items: center; gap: 5px;
  }
  .pw-current-val {
    font-family: 'Lato', sans-serif; letter-spacing: 0.12em;
    color: var(--dark); font-style: normal;
    background: var(--petal); padding: 2px 8px; border-radius: 6px;
    font-size: 0.78rem;
  }

  .pw-save-btn {
    width: 100%; padding: 13px;
    background: linear-gradient(135deg, var(--rose), #e07090);
    color: #fff; border: none; border-radius: 12px;
    font-family: 'Lato', sans-serif; font-size: 0.85rem;
    letter-spacing: 0.1em; text-transform: uppercase;
    cursor: pointer; transition: all 0.25s;
    box-shadow: 0 4px 16px rgba(201,80,106,0.25);
  }
  .pw-save-btn:hover { transform: translateY(-2px); box-shadow: 0 8px 24px rgba(201,80,106,0.35); }

  .pw-success {
    text-align: center; margin-top: 12px;
    font-family: 'Cormorant Garamond', serif; font-style: italic;
    font-size: 0.95rem; color: #5a9e6f; min-height: 20px;
    animation: fadeIn 0.4s ease;
  }
  .pw-error {
    text-align: center; margin-top: 12px;
    font-family: 'Cormorant Garamond', serif; font-style: italic;
    font-size: 0.95rem; color: var(--rose); min-height: 20px;
  }
  @keyframes fadeIn { from{opacity:0;} to{opacity:1;} }

  /* â”€â”€â”€ GALLERY â”€â”€â”€ */
  .gallery-section { max-width: 1200px; margin: 0 auto; padding: 0 24px 100px; }
  .gallery-section h2 {
    font-family: 'Playfair Display', serif; font-size: 1.6rem;
    color: var(--dark); margin-bottom: 36px; text-align: center; font-style: italic;
  }
  .gallery-grid { columns: 3; column-gap: 20px; }
  @media (max-width: 900px) { .gallery-grid { columns: 2; } }
  @media (max-width: 560px) { .gallery-grid { columns: 1; } }

  .photo-card {
    break-inside: avoid; margin-bottom: 20px; background: #fff;
    border-radius: 16px; overflow: hidden;
    box-shadow: 0 4px 20px rgba(44,26,31,0.07), 0 1px 4px rgba(44,26,31,0.05);
    position: relative; cursor: pointer; opacity: 0;
    transition: transform 0.3s cubic-bezier(0.34,1.56,0.64,1), box-shadow 0.3s;
    animation: cardIn 0.6s cubic-bezier(0.22,1,0.36,1) both;
  }
  .photo-card.visible { opacity: 1; }
  @keyframes cardIn {
    from { opacity: 0; transform: translateY(30px) scale(0.95); }
    to   { opacity: 1; transform: translateY(0) scale(1); }
  }
  .photo-card:hover {
    transform: translateY(-6px) scale(1.01);
    box-shadow: 0 16px 48px rgba(44,26,31,0.13), 0 4px 12px rgba(201,80,106,0.1);
  }
  .photo-card img { width: 100%; display: block; object-fit: cover; }
  .photo-card-footer { padding: 14px 18px 16px; }
  .photo-caption {
    font-family: 'Cormorant Garamond', serif; font-size: 1.05rem;
    font-style: italic; color: var(--dark); line-height: 1.5;
  }
  .photo-date { font-size: 0.72rem; color: var(--muted); margin-top: 5px; letter-spacing: 0.05em; }

  .photo-card-actions { position: absolute; top: 10px; right: 10px; display: none; gap: 6px; }
  .admin-mode .photo-card:hover .photo-card-actions { display: flex; }
  .del-btn {
    background: rgba(201,80,106,0.85); color: #fff; border: none;
    border-radius: 8px; padding: 5px 10px; font-size: 0.75rem;
    cursor: pointer; transition: background 0.2s;
  }
  .del-btn:hover { background: var(--rose); }

  /* â”€â”€â”€ LIGHTBOX â”€â”€â”€ */
  #lightbox {
    position: fixed; inset: 0; z-index: 200;
    background: rgba(28,10,14,0.92); backdrop-filter: blur(10px);
    display: none; align-items: center; justify-content: center; padding: 24px;
  }
  #lightbox.open { display: flex; animation: fadeIn2 0.2s ease; }
  @keyframes fadeIn2 { from{opacity:0;} to{opacity:1;} }

  .lb-inner { position: relative; max-width: 880px; width: 100%; animation: lbIn 0.35s cubic-bezier(0.22,1,0.36,1); }
  @keyframes lbIn { from{transform:scale(0.88);opacity:0;} to{transform:scale(1);opacity:1;} }
  #lb-img { width:100%; max-height:78vh; object-fit:contain; border-radius:16px; display:block; }
  #lb-caption {
    font-family:'Cormorant Garamond',serif; font-size:1.35rem; font-style:italic;
    color:rgba(255,255,255,0.88); text-align:center; margin-top:20px; line-height:1.5;
  }
  .lb-close {
    position:absolute; top:-44px; right:0; background:none; border:none;
    color:rgba(255,255,255,0.6); font-size:1.8rem; cursor:pointer;
    line-height:1; transition:color 0.2s, transform 0.2s;
  }
  .lb-close:hover { color:#fff; transform:rotate(90deg); }
  .lb-nav {
    position:absolute; top:50%; transform:translateY(-50%);
    background:rgba(255,255,255,0.12); border:none; color:#fff;
    width:48px; height:48px; border-radius:50%; font-size:1.3rem;
    cursor:pointer; transition:background 0.2s;
    display:flex; align-items:center; justify-content:center;
  }
  .lb-nav:hover { background:rgba(201,80,106,0.5); }
  .lb-prev{left:-64px;} .lb-next{right:-64px;}
  @media(max-width:700px){.lb-prev{left:8px;}.lb-next{right:8px;}}

  /* â”€â”€â”€ EMPTY â”€â”€â”€ */
  .empty-gallery { text-align:center; padding:80px 24px; color:var(--muted); }
  .empty-gallery .big-icon { font-size:4rem; margin-bottom:16px; display:block; opacity:0.4; }
  .empty-gallery p { font-family:'Cormorant Garamond',serif; font-size:1.2rem; font-style:italic; }

  /* â”€â”€â”€ FOOTER â”€â”€â”€ */
  footer {
    text-align:center; padding:32px;
    border-top:1px solid rgba(201,80,106,0.1);
    font-family:'Cormorant Garamond',serif; font-size:1rem;
    color:var(--muted); font-style:italic; letter-spacing:0.04em;
    position:relative; z-index:1;
  }

  /* â”€â”€â”€ MESSAGE BANNER â”€â”€â”€ */
  #message-banner {
    position:fixed; top:88px; left:50%; transform:translateX(-50%);
    background:linear-gradient(135deg,#fff0f3,#fff);
    border:1px solid rgba(201,80,106,0.25); border-radius:14px;
    padding:16px 28px; box-shadow:0 8px 30px rgba(201,80,106,0.15);
    z-index:999; display:none;
    font-family:'Cormorant Garamond',serif; font-size:1.1rem;
    font-style:italic; color:var(--rose); white-space:nowrap;
    animation:slideDownBanner 0.4s cubic-bezier(0.22,1,0.36,1);
  }
  @keyframes slideDownBanner {
    from{transform:translateX(-50%) translateY(-20px);opacity:0;}
    to{transform:translateX(-50%) translateY(0);opacity:1;}
  }
</style>
</head>
<body>

<canvas id="petals-canvas"></canvas>

<!-- LOGIN -->
<div id="login-screen">
  <div class="login-box">
    <span class="login-heart">â™¡</span>
    <h1 class="login-title">For You</h1>
    <p class="login-subtitle">A little world made just for you</p>
    <div class="tab-group">
      <button class="tab-btn active" onclick="switchTab('admin')">My View</button>
      <button class="tab-btn" onclick="switchTab('viewer')">Her View</button>
    </div>
    <div class="login-field">
      <label>Password</label>
      <input type="password" id="pw-input" placeholder="Enter password..." onkeydown="if(event.key==='Enter') doLogin()"/>
    </div>
    <button class="login-btn" onclick="doLogin()">Enter â™¡</button>
    <p class="login-error" id="login-error"></p>
  </div>
</div>

<!-- MAIN -->
<div id="main-site">
  <header>
    <div class="header-brand">For You â™¡</div>
    <div class="header-right">
      <span class="role-badge" id="role-badge">viewer</span>
      <button class="logout-btn" onclick="location.reload()">â† Leave</button>
    </div>
  </header>

  <section class="hero">
    <span class="hero-eyebrow">âœ¦ A Collection Made With Love âœ¦</span>
    <h1 class="hero-title">Every photo of<br><em>you</em> is magic</h1>
    <p class="hero-subtitle" id="hero-subtitle-text">Scroll through and see yourself through my eyes â€” beautiful, always.</p>
    <div class="hero-divider">â™¡</div>
  </section>

  <!-- ADMIN PANEL -->
  <div id="admin-panel">

    <!-- Upload Zone -->
    <div class="upload-zone" id="drop-zone">
      <input type="file" id="file-input" accept="image/*" multiple onchange="handleFiles(this.files)"/>
      <span class="upload-icon">ğŸ“·</span>
      <p class="upload-text">Drop photos here or click to choose</p>
      <p class="upload-hint">JPG, PNG, WEBP â€” as many as you like</p>
    </div>
    <div class="caption-input-group">
      <input type="text" id="caption-input" placeholder="Add a caption for the next photo..."/>
    </div>

    <!-- â”€â”€â”€ PASSWORD MANAGER â”€â”€â”€ -->
    <div class="pw-manager">
      <div class="pw-manager-header" onclick="togglePwManager()">
        <div class="pw-manager-title">
          <span>ğŸ”</span> Manage Passwords
        </div>
        <span class="pw-toggle-icon" id="pw-toggle-icon">â–¼</span>
      </div>
      <div class="pw-manager-body" id="pw-manager-body">

        <div class="pw-row">
          <!-- My (Admin) Password -->
          <div class="pw-field">
            <label>My Password (Admin)</label>
            <div class="pw-field-inner">
              <input type="password" id="new-admin-pw" placeholder="New admin password..."/>
              <button class="eye-btn" onclick="toggleEye('new-admin-pw', this)" title="Show/hide">ğŸ‘</button>
            </div>
            <div class="pw-current">
              Current: <span class="pw-current-val" id="show-admin-pw">â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢</span>
              <button class="eye-btn" style="position:static;transform:none;font-size:0.8rem;" onclick="revealCurrent('admin')" title="Reveal">ğŸ‘</button>
            </div>
          </div>

          <!-- Her (Viewer) Password -->
          <div class="pw-field">
            <label>Her Password (Viewer)</label>
            <div class="pw-field-inner">
              <input type="password" id="new-viewer-pw" placeholder="New viewer password..."/>
              <button class="eye-btn" onclick="toggleEye('new-viewer-pw', this)" title="Show/hide">ğŸ‘</button>
            </div>
            <div class="pw-current">
              Current: <span class="pw-current-val" id="show-viewer-pw">â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢</span>
              <button class="eye-btn" style="position:static;transform:none;font-size:0.8rem;" onclick="revealCurrent('viewer')" title="Reveal">ğŸ‘</button>
            </div>
          </div>
        </div>

        <button class="pw-save-btn" onclick="savePasswords()">Save Passwords â™¡</button>
        <p class="pw-success" id="pw-success"></p>
        <p class="pw-error"   id="pw-error"></p>
      </div>
    </div>

  </div><!-- /admin-panel -->

  <!-- GALLERY -->
  <section class="gallery-section">
    <h2>Our Moments Together</h2>
    <div class="gallery-grid" id="gallery-grid"></div>
    <div class="empty-gallery" id="empty-state">
      <span class="big-icon">ğŸŒ¸</span>
      <p>Photos will bloom here soon...</p>
    </div>
  </section>

  <footer>Made with â™¡ just for you â€” every picture, every memory, all yours.</footer>
</div>

<!-- LIGHTBOX -->
<div id="lightbox" onclick="closeLightbox(event)">
  <div class="lb-inner">
    <button class="lb-close" onclick="closeLightbox()">âœ•</button>
    <button class="lb-nav lb-prev" onclick="lbNavigate(-1);event.stopPropagation()">â€¹</button>
    <button class="lb-nav lb-next" onclick="lbNavigate(1);event.stopPropagation()">â€º</button>
    <img id="lb-img" src="" alt=""/>
    <p id="lb-caption"></p>
  </div>
</div>

<div id="message-banner"></div>

<script>
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// DEFAULT PASSWORDS (first time only)
// After saving new ones, localStorage takes over
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
const DEFAULT_ADMIN_PW  = 'myadmin123';
const DEFAULT_VIEWER_PW = 'hername2025';

const LOVE_NOTE_FOR_HER   = "I made this just for you â™¡ Every photo here is proof of how beautiful you are to me.";
const HERO_SUBTITLE_ADMIN = "You're the curator of her heart â€” add all the beautiful moments.";

// â”€â”€ Load passwords from storage (or use defaults) â”€â”€
function getAdminPw()  { return localStorage.getItem('pw_admin')  || DEFAULT_ADMIN_PW;  }
function getViewerPw() { return localStorage.getItem('pw_viewer') || DEFAULT_VIEWER_PW; }

// â”€â”€ State â”€â”€
let currentTab = 'admin';
let photos = [];
let lbIndex = 0;
try { photos = JSON.parse(localStorage.getItem('gallery_photos') || '[]'); } catch(e){}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// PETALS
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
const canvas = document.getElementById('petals-canvas');
const ctx = canvas.getContext('2d');
let petals = [];
function resizeCanvas() { canvas.width = innerWidth; canvas.height = innerHeight; }
function createPetal() {
  return { x: Math.random()*canvas.width, y: -20, size: 6+Math.random()*10,
    speedY: 0.6+Math.random()*1.2, speedX: (Math.random()-0.5)*0.6,
    rotation: Math.random()*Math.PI*2, rotSpeed: (Math.random()-0.5)*0.04,
    opacity: 0.3+Math.random()*0.5, hue: 340+Math.random()*20 };
}
function drawPetals() {
  ctx.clearRect(0,0,canvas.width,canvas.height);
  if(petals.length<18) petals.push(createPetal());
  petals = petals.filter(p=>p.y<canvas.height+30);
  petals.forEach(p=>{
    p.y+=p.speedY; p.x+=p.speedX+Math.sin(p.y*0.015)*0.5; p.rotation+=p.rotSpeed;
    ctx.save(); ctx.translate(p.x,p.y); ctx.rotate(p.rotation);
    ctx.globalAlpha=p.opacity; ctx.fillStyle=`hsl(${p.hue},70%,78%)`;
    ctx.beginPath(); ctx.ellipse(0,0,p.size*0.55,p.size,0,0,Math.PI*2); ctx.fill(); ctx.restore();
  });
  requestAnimationFrame(drawPetals);
}
resizeCanvas(); addEventListener('resize',resizeCanvas); drawPetals();

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// LOGIN
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function switchTab(role) {
  currentTab = role;
  document.querySelectorAll('.tab-btn').forEach((b,i)=>
    b.classList.toggle('active',(role==='admin'&&i===0)||(role==='viewer'&&i===1)));
  document.getElementById('login-error').textContent='';
}

function doLogin() {
  const pw  = document.getElementById('pw-input').value.trim();
  const err = document.getElementById('login-error');
  if(currentTab==='admin'  && pw===getAdminPw())  { enterSite('admin');  return; }
  if(currentTab==='viewer' && pw===getViewerPw()) { enterSite('viewer'); return; }
  err.textContent = "Hmm, that doesn't seem right â™¡";
  document.getElementById('pw-input').value='';
}

function enterSite(role) {
  const ls = document.getElementById('login-screen');
  ls.style.opacity='0'; ls.style.transition='opacity 0.6s';
  setTimeout(()=>{
    ls.style.display='none';
    const ms = document.getElementById('main-site');
    ms.style.display='block';
    document.getElementById('role-badge').textContent = role==='admin'?'âœ¦ admin':'â™¡ viewer';
    if(role==='admin'){
      document.getElementById('admin-panel').style.display='block';
      ms.classList.add('admin-mode');
      document.getElementById('hero-subtitle-text').textContent=HERO_SUBTITLE_ADMIN;
    } else {
      showBanner(LOVE_NOTE_FOR_HER);
    }
    renderGallery(); setupDragDrop();
  },600);
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// PASSWORD MANAGER
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function togglePwManager() {
  const body = document.getElementById('pw-manager-body');
  const icon = document.getElementById('pw-toggle-icon');
  const isOpen = body.classList.toggle('open');
  icon.classList.toggle('open', isOpen);
}

function toggleEye(inputId, btn) {
  const inp = document.getElementById(inputId);
  if(inp.type==='password'){ inp.type='text'; btn.textContent='ğŸ™ˆ'; }
  else { inp.type='password'; btn.textContent='ğŸ‘'; }
}

let adminRevealed  = false;
let viewerRevealed = false;
function revealCurrent(who) {
  if(who==='admin'){
    adminRevealed = !adminRevealed;
    document.getElementById('show-admin-pw').textContent = adminRevealed ? getAdminPw() : 'â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢';
  } else {
    viewerRevealed = !viewerRevealed;
    document.getElementById('show-viewer-pw').textContent = viewerRevealed ? getViewerPw() : 'â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢';
  }
}

function savePasswords() {
  const newAdmin  = document.getElementById('new-admin-pw').value.trim();
  const newViewer = document.getElementById('new-viewer-pw').value.trim();
  const success   = document.getElementById('pw-success');
  const error     = document.getElementById('pw-error');
  success.textContent=''; error.textContent='';

  if(!newAdmin && !newViewer) {
    error.textContent = 'Please enter at least one new password â™¡';
    return;
  }
  if(newAdmin && newAdmin.length < 4) {
    error.textContent = 'Admin password must be at least 4 characters â™¡';
    return;
  }
  if(newViewer && newViewer.length < 4) {
    error.textContent = 'Her password must be at least 4 characters â™¡';
    return;
  }

  if(newAdmin)  localStorage.setItem('pw_admin',  newAdmin);
  if(newViewer) localStorage.setItem('pw_viewer', newViewer);

  // Reset inputs & revealed states
  document.getElementById('new-admin-pw').value='';
  document.getElementById('new-viewer-pw').value='';
  document.getElementById('new-admin-pw').type='password';
  document.getElementById('new-viewer-pw').type='password';
  adminRevealed=false; viewerRevealed=false;
  document.getElementById('show-admin-pw').textContent='â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢';
  document.getElementById('show-viewer-pw').textContent='â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢';

  let msg = '';
  if(newAdmin && newViewer) msg = 'âœ“ Both passwords updated successfully â™¡';
  else if(newAdmin)  msg = 'âœ“ Your admin password updated â™¡';
  else               msg = 'âœ“ Her password updated â™¡';

  success.textContent = msg;
  setTimeout(()=>{ success.textContent=''; },4000);
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// DRAG & DROP
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function setupDragDrop() {
  const dz=document.getElementById('drop-zone'); if(!dz)return;
  dz.addEventListener('dragover',e=>{e.preventDefault();dz.classList.add('dragover');});
  dz.addEventListener('dragleave',()=>dz.classList.remove('dragover'));
  dz.addEventListener('drop',e=>{e.preventDefault();dz.classList.remove('dragover');handleFiles(e.dataTransfer.files);});
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// PHOTOS
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function handleFiles(fileList) {
  const cap = document.getElementById('caption-input').value.trim();
  Array.from(fileList).forEach(file=>{
    if(!file.type.startsWith('image/'))return;
    const reader=new FileReader();
    reader.onload=e=>{
      photos.push({id:Date.now()+Math.random(),src:e.target.result,caption:cap||'',
        date:new Date().toLocaleDateString('en-US',{month:'long',day:'numeric',year:'numeric'})});
      savePhotos(); renderGallery();
    };
    reader.readAsDataURL(file);
  });
  document.getElementById('caption-input').value='';
  document.getElementById('file-input').value='';
}

function deletePhoto(id) { photos=photos.filter(p=>p.id!==id); savePhotos(); renderGallery(); }
function savePhotos() { try{localStorage.setItem('gallery_photos',JSON.stringify(photos));}catch(e){} }

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// GALLERY
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function renderGallery() {
  const grid  = document.getElementById('gallery-grid');
  const empty = document.getElementById('empty-state');
  const isAdm = document.getElementById('main-site').classList.contains('admin-mode');
  grid.innerHTML='';
  empty.style.display = photos.length===0?'block':'none';
  photos.forEach((p,idx)=>{
    const card=document.createElement('div');
    card.className='photo-card';
    card.style.animationDelay=(idx*0.06)+'s';
    card.innerHTML=`
      <img src="${p.src}" alt="${p.caption}" loading="lazy" onclick="openLightbox(${idx})"/>
      ${(p.caption||p.date)?`<div class="photo-card-footer">
        ${p.caption?`<p class="photo-caption">${p.caption}</p>`:''}
        ${p.date?`<p class="photo-date">${p.date}</p>`:''}
      </div>`:''}
      ${isAdm?`<div class="photo-card-actions">
        <button class="del-btn" onclick="event.stopPropagation();deletePhoto(${p.id})">Remove</button>
      </div>`:''}`;
    grid.appendChild(card);
  });
  const obs=new IntersectionObserver(entries=>entries.forEach(e=>{
    if(e.isIntersecting){e.target.classList.add('visible');obs.unobserve(e.target);}
  }),{threshold:0.1});
  grid.querySelectorAll('.photo-card').forEach(c=>obs.observe(c));
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// LIGHTBOX
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function openLightbox(idx) { lbIndex=idx; updateLb(); document.getElementById('lightbox').classList.add('open'); document.body.style.overflow='hidden'; }
function closeLightbox(e) { if(e&&e.target!==document.getElementById('lightbox'))return; document.getElementById('lightbox').classList.remove('open'); document.body.style.overflow=''; }
function updateLb() { const p=photos[lbIndex]; document.getElementById('lb-img').src=p.src; document.getElementById('lb-caption').textContent=p.caption||''; }
function lbNavigate(d) { lbIndex=(lbIndex+d+photos.length)%photos.length; updateLb(); }
document.addEventListener('keydown',e=>{
  if(!document.getElementById('lightbox').classList.contains('open'))return;
  if(e.key==='ArrowLeft')lbNavigate(-1);
  if(e.key==='ArrowRight')lbNavigate(1);
  if(e.key==='Escape')closeLightbox();
});

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// BANNER
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function showBanner(msg) {
  const b=document.getElementById('message-banner');
  b.textContent=msg; b.style.display='block';
  setTimeout(()=>{b.style.transition='opacity 0.8s';b.style.opacity='0';
    setTimeout(()=>{b.style.display='none';b.style.opacity='1';},800);},5000);
}
</script>
</body>
</html>
